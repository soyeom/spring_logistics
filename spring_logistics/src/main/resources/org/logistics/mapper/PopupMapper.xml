<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.logistics.mapper.PopupMapper">

    <!-- 倉庫ポップアップ -->
    <select id="warehouse_List" resultType="org.logistics.domain.WareHouseVO">
        SELECT 
            wd.warehouse_id AS warehouseId,
            wd.warehouse_name AS warehouseName,
            bu.bu_name AS buName,
            wm.warehouse_internal_code AS warehouseInternalCode,
            bu.bu_id AS buId,
            wm.warehouse_master_id AS warehouseMasterId
        FROM warehouse_detail wd
        JOIN business_unit bu
            ON wd.bu_id = bu.bu_id
        JOIN warehouse_master wm
            ON wd.warehouse_master_id = wm.warehouse_master_id
           AND wd.bu_id = wm.bu_id
        <where>
            <if test="gubun == '10'">
                CAST(wd.warehouse_id AS varchar(50)) LIKE '%' || #{text} || '%'
            </if>
            <if test="gubun == '20'">
                wd.warehouse_name LIKE '%' || #{text} || '%'
            </if>
        </where>
    </select>

    <!-- 連絡先ポップアップ -->
    <select id="contact_List" resultType="org.logistics.domain.PopupVO">
        SELECT 
            contact_id AS column1,
            contact_name AS column2,
            department AS column3,
            phone AS column4,
            mobile AS column5,
            email AS column6
        FROM contact
        <where>
            <if test="gubun == '10'">
                contact_id LIKE '%' || #{text} || '%'
            </if>
            <if test="gubun == '20'">
                contact_name LIKE '%' || #{text} || '%'
            </if>
        </where>
    </select>

    <!-- 小分類ポップアップ -->
    <select id="itemSmallcategory_List" resultType="org.logistics.domain.PopupVO">
        SELECT 
            im.small_category AS column1,   
            im.mid_category   AS column2,   
            im.big_category   AS column3   
        FROM item_master im
        <where>
            <if test="gubun == '10'">
                im.small_category LIKE '%' || #{text} || '%'
            </if>
            <if test="gubun == '20'">
                im.mid_category LIKE '%' || #{text} || '%'
            </if>
            <if test="gubun == '30'">
                im.big_category LIKE '%' || #{text} || '%'
            </if>
        </where>
        GROUP BY im.small_category, im.mid_category, im.big_category
        ORDER BY im.big_category, im.mid_category, im.small_category
    </select>

</mapper>

<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "org.logistics.mapper.PopupMapper">
	
	<select id = "item_List" resultType = "org.logistics.domain.PopupVO">
		
		select item_Id as column1
		     , item_name as column2
		     , spec as column3
		     , asset_class as column4
		     , small_category as column5
		     , base_unit as column6 
		     , sales_unit as column7 
		     , english_name as column8
		     , safety_stock_qty as column9
		     , (select warehouse_name from warehouse_detail where bu_id = a.bu_id and warehouse_id = a.storage_location) as column10
		from item_master a
		
		<where>
	        <if test = "gubun == 10">
	            item_Id like '%' ||  #{text} || '%'
	        </if>
	        <if test = "gubun == 20">
	        	item_name like '%' ||  #{text} || '%'
	        </if>
    	</where>
		
	</select>
	
	<select id = "contact_List" resultType = "org.logistics.domain.PopupVO">
	
		select contact_id as column1
		     , contact_name column2
		     , department as column3
		     , phone as column4
		     , mobile as column5
		     , email as column6
		from contact
		<where>
	        <if test = "gubun == 10">
	            contact_id like '%' ||  #{text} || '%'
	        </if>
	        <if test = "gubun == 20">
	        	contact_name like '%' ||  #{text} || '%'
	        </if>
    	</where>
	
	</select>
	
	<select id = "out_Id_List" resultType = "org.logistics.domain.PopupVO">
	
		select out_id as column1
			 , bu_id as column2
			 , (select bu_Name from business_unit where bu_id = a.bu_Id) as column15
			 , to_char(out_date, 'yyyy-MM-dd') as column3
		     , local_flag as column4
		     , case when local_flag = '10' then '내수' when local_flag = '20' then 'Local(후LC)' when local_flag = '30' then 'Local(선LC)' end as column5
		     , party_id as column6
		     , (select party_name from party where bu_id = a.bu_id and party_id = a.party_id) as column7
		     , contact_id as column8
		     , (select contact_name from contact where bu_id = a.bu_Id and contact_id = a.contact_id) as column9
		     , (select department from contact where bu_id = a.bu_Id and contact_id = a.contact_id) as column10
		     , out_type as column11
		     , case when out_type = '10' then '수주' when out_type = '20' then '적송요청' when out_type = '30' then '위탁출고요청' when out_type = '40' then '기타출고요청' end as column12
		     , consignment_gubun as column13
		     , case when consignment_gubun = '10' then '일반' when consignment_gubun = '20' then '위탁' when consignment_gubun = '30' then '판매후보관' end as column14
		     , out_complete, created_at
		from out_master a
		<where>
	        <if test = "gubun == 10">
	            bu_Id like '%' ||  #{text} || '%'
	        </if>
	        <if test = "gubun == 20">
	        	out_Id like '%' ||  #{text} || '%'
	        </if>
    	</where>
	
	</select>
	
	<select id = "party_List" resultType = "org.logistics.domain.PopupVO">
	
		select bu_Id as column1         
	         , (select bu_Name from business_unit where bu_id = a.bu_Id) as column2
	     	 , party_Id as column3      
		     , party_Name as column4    
		     , party_type as column5    
		     , case when party_type = '10' then '납품' when party_type = '20' then '영업' when party_type = '30' then '거래처' when party_type = '40' then '공급바' end as column6
		     , business_registration_no as column7
		     , trade_name as column8    
		     , short_name as column9    
		     , address as column10       
		     , phone as column11        
		     , email as column12        
		from party a

		<where>
        	<if test = "gubun == 10">
	            bu_Id like '%' ||  #{text} || '%'
	        </if>
	        <if test = "gubun == 20">
	        	party_name like '%' ||  #{text} || '%'
	        </if>
	        <if test = "gubun == 30">
	        	party_Id like '%' ||  #{text} || '%'
	        </if>
    	</where>
	</select>
	
	
	<select id = "category_List_Big" resultType = "org.logistics.domain.PopupVO">
	
		select item_id as column1
		     , big_category as column2
		from item_master
		<where>
	        <if test = "gubun == 10">
	            big_category like '%' ||  #{text} || '%'
	        </if>
    	</where>
	
	</select>
	
	<select id = "category_List_Mid" resultType = "org.logistics.domain.PopupVO">
	
		select item_id as column1
		     , big_category as column2
		     , mid_category as column3
		from item_master
		<where>
	        <if test = "gubun == 10">
	            mid_category like '%' ||  #{text} || '%'
	        </if>
    	</where>
	
	</select>
	
	<select id = "category_List_Small" resultType = "org.logistics.domain.PopupVO">
	
		select item_id as column1
		     , big_category as column2
		     , mid_category as column3
		     , small_category as column4
		from item_master
		<where>
	        <if test = "gubun == 10">
	            small_category like '%' ||  #{text} || '%'
	        </if>
    	</where>
	
	</select>
	
	<select id = "itemname_List" resultType = "org.logistics.domain.PopupVO">
	
		select item_id as column1
			, spec as column2
			, item_name as column3
			, asset_class as column4
			, small_category as column5
			, base_unit as column6
			, english_name as column7
		from item_master
		
		<where>
			<if test = "gubun == 10">
				item_name like '%' || #{text} || '%'
			</if>
			<if test = "gubun == 20">
				item_id like '%' || #{text} || '%'
			</if>
			<if test = "gubun == 30">
				spec like '%' || #{text} || '%'
			</if>
			<if test = "gubun == 40">
				english_name like '%' || #{text} || '%'
			</if>
		</where>
	
	</select>
    
        <select id="warehousecode_List" resultType="org.logistics.domain.PopupVO">
        SELECT DISTINCT warehouse_internal_code AS column1
             , warehouse_internal_code           AS column2
        FROM warehouse_master
        <where>
            <if test="gubun == '10'">
                warehouse_internal_code LIKE '%' || #{text} || '%'
            </if>
        </where>
    </select>
    
        <select id="warehousename_List" resultType="org.logistics.domain.PopupVO">
        SELECT DISTINCT w.warehouse_id   AS column1
             , w.warehouse_name          AS column2
             , w.bu_id                   AS column3
        FROM warehouse_detail w
        <where>
            <if test="gubun == '10'">
                w.warehouse_name LIKE '%' || #{text} || '%'
            </if>
        </where>
  </select>
	
	
	 <!-- ================== 수주번호 (inbound_master) ================진형== --> 
 <select id="inboundMaster_List" resultType="org.logistics.domain.PopupVO">
    SELECT ib.inbound_id       AS column1,
           bu.bu_name          AS column2,
           TO_CHAR(ib.inbound_date, 'YYYY-MM-DD') AS column3,
           ib.local_flag       AS column4,
           p.party_name        AS column5,
           c.contact_name      AS column6,
           ib.inbound_type     AS column7,
           ib.inbound_complete AS column8,
           TO_CHAR(ib.created_at, 'YYYY-MM-DD') AS column9,
           p.party_id          AS column10,   -- 거래처번호
           c.department        AS column11,    -- 부서
           bu.bu_id            AS column12
    FROM inbound_master ib
    JOIN business_unit bu ON ib.bu_id = bu.bu_id
    JOIN party p          ON ib.party_id = p.party_id
    JOIN contact c        ON ib.contact_id = c.contact_id  <!-- ✅ INNER JOIN -->
    <where>
        <if test="gubun == '10'">
            ib.inbound_id LIKE '%' || #{text} || '%'
        </if>
        <if test="gubun == '20'">
            bu.bu_name LIKE '%' || #{text} || '%'
        </if>
        <if test="gubun == '30'">
            TO_CHAR(ib.inbound_date, 'YYYY-MM-DD') LIKE '%' || #{text} || '%'
        </if>
        <if test="gubun == '40'">
            ib.local_flag LIKE '%' || #{text} || '%'
        </if>
        <if test="gubun == '50'">
            p.party_name LIKE '%' || #{text} || '%'
        </if>
        <if test="gubun == '60'">
            c.contact_name LIKE '%' || #{text} || '%'
        </if>
        <if test="gubun == '70'">
            ib.inbound_type LIKE '%' || #{text} || '%'
        </if>
        <if test="gubun == '80'">
            ib.inbound_complete LIKE '%' || #{text} || '%'
        </if>
        <if test="gubun == '90'">
            TO_CHAR(ib.created_at, 'YYYY-MM-DD') LIKE '%' || #{text} || '%'
        </if>
    </where>
</select>

</mapper>